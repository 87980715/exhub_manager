<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layout 后台大布局 - Layui</title>
    <link rel="stylesheet" href="../../static/layui/css/layui.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div th:include="/common/header :: header"></div>
    <div class="layui-body">
        <!-- 数据表格 -->
        <table class="layui-table" lay-filter="identityList">
            <thead>
            <tr>
                <th lay-data="{field:'id', width:60, fixed: 'left'}">用户编号</th>
                <th lay-data="{field:'createTime', width:80}">申请时间</th>
                <th lay-data="{field:'fristName', width:80}">名</th>
                <th lay-data="{field:'lastName', width:80}">姓</th>
                <th lay-data="{field:'countryRegion', width:70}">国家/地区</th>
                <th lay-data="{field:'idType', width:80}">证件类型</th>
                <th lay-data="{field:'idNumber', width:80}">证件号码</th>
                <th lay-data="{field:'status', width:80}">实名状态</th>
                <th lay-data="{field:'message', width:80, fixed: 'right'}">拒绝理由</th>
                <th lay-data="{width:100, align:'center', toolbar: '#barDemo', align:'center', fixed: 'right'}">操作</th>
            </tr>
            </thead>
        </table>
        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
        </script>
    </div>
    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © exhub.io
    </div>
</div>
<script src="../../static/layui/layui.js"></script>
<script>
    //列表
    layui.use('element', function () {
        var element = layui.element;
    });
    (function () {
        //加载列表的后端 url
        var getListUrl = '/user/identity/authentication/1/10';
        var tableOptions = {
            width: 892,
            height: 332,
            url: getListUrl, //请求地址
            method: 'POST', //方式
            contentType: 'application/json',
            request: {
                fristName: ''
                , lastName: ''
                , countryRegion: ''
                , startTime: ''
                , endTime: ''
                , idType: ''
                , idNumber: ''
                , status: ''
            },
            id: 'listReload', //生成 Layui table 的标识 id，必须提供，用于后文刷新操作，笔者该处出过问题
            page: true, //是否分页
            where: {type: "all"}, //请求后端接口的条件，该处就是条件错误点，按照官方给出的代码示例，原先写成了 where: { key : { type: "all" } }，结果并不是我想的那样，如此写，key 将是后端的一个类作为参数，里面有 type 属性，如果误以为 key 是 Layui 提供的格式，那就大错特错了
            response: { //定义后端 json 格式，详细参见官方文档
                statusName: 'code', //状态字段名称
                statusCode: '0', //状态字段成功值
                msgName: 'msg', //消息字段
                countName: 'count', //总数字段
                dataName: 'data' //数据字段
            }
        };

        //
        layui.use(['table', 'layer'], function () {//layui 模块引用，根据需要自行修改
            var layer = layui.layer, table = layui.table;

            //表初始化
            var createTable = function () {
                table.init('identityList', tableOptions);
            };

            //监听工具条
            table.on('tool(identityList)', function (obj) {
                var data = obj.data;
                if (obj.event === 'detail') {
                    layer.msg('ID：' + data.id + ' 的查看操作');
                    //跳转到申请详情/identity/{id}
                    window.location.href = '/user/identity/' + data.id;
                }
            });

            //表刷新方法
            var reloadTable = function (item) {
                table.reload("listReload", { //此处是上文提到的 初始化标识id
                    where: {
                        //key: { //该写法上文已经提到
                        type: item.type, id: item.id
                        //}
                    }
                });
            };

            //表初始化
            createTable();

            //其他和 tree 相关的方法，其中包括 点击 tree 项调用刷新方法
        });
    })();

</script>
</body>
</html>